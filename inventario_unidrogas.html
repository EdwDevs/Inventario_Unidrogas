<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Pharma - Unidrogas, Drosan, Copidrogas</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen flex flex-col overflow-hidden">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- ICONOS SVG (Reemplazo de lucide-react para HTML standalone) ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Search = ({ className }) => <IconBase className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></IconBase>;
        const ShoppingCart = ({ className }) => <IconBase className={className}><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></IconBase>;
        const TrendingDown = ({ className }) => <IconBase className={className}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></IconBase>;
        const Package = ({ className }) => <IconBase className={className}><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></IconBase>;
        const DollarSign = ({ className }) => <IconBase className={className}><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></IconBase>;
        const Trash2 = ({ className }) => <IconBase className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconBase>;
        const ArrowUpDown = ({ className }) => <IconBase className={className}><path d="M7 20V4"></path><path d="M12.95 10.05 17 6.01 21.05 10.05"></path><path d="M17 20V4"></path><path d="M11.05 14.95 7 19.01 2.95 14.95"></path></IconBase>;
        const AlertCircle = ({ className }) => <IconBase className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconBase>;
        const Store = ({ className }) => <IconBase className={className}><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"></path><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"></path><path d="M2 7h20"></path><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"></path></IconBase>;
        const RefreshCw = ({ className }) => <IconBase className={className}><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></IconBase>;

        // --- COMPONENTE PRINCIPAL ---
        const ProductCatalog = () => {
            const [supplier, setSupplier] = useState('Unidrogas'); 
            const [searchTerm, setSearchTerm] = useState('');
            const [cart, setCart] = useState({});
            const [sortOrder, setSortOrder] = useState('asc'); 

            // --- LÓGICA DE PERSISTENCIA (CACHE) ---
            useEffect(() => {
                try {
                    const savedCart = localStorage.getItem('pharmaCart_v1');
                    if (savedCart) {
                        setCart(JSON.parse(savedCart));
                    }
                } catch (error) {
                    console.error("Error al cargar la cache:", error);
                }
            }, []);

            useEffect(() => {
                try {
                    if (Object.keys(cart).length > 0) {
                        localStorage.setItem('pharmaCart_v1', JSON.stringify(cart));
                    }
                } catch (error) {
                    console.error("Error al guardar en cache:", error);
                }
            }, [cart]);

            const UNIDROGAS_DISCOUNT_RATE = 0.12;

            // --- DATOS UNIDROGAS ---
            const productsUnidrogas = [
                { id: 'u1', name: "Airmax Salbutamol 100 Mcg Inhalador X 200 Dosis", price: 28628.82, category: "Respiratorio", hasDiscount: true },
                { id: 'u2', name: "Airmax Salbutamol 100 Mcg Inhalador X 200 Dosis 1+2", price: 28643.82, category: "Respiratorio", hasDiscount: true },
                { id: 'u3', name: "Aspromio Ipratropio 0.4 Mg/ml Inhalador X 200 Dosis", price: 19104.97, category: "Respiratorio", hasDiscount: false },
                { id: 'u4', name: "Clobezan Clobetasol 0.05% Crema X 25 Gr", price: 42943.24, category: "Dermatológico", hasDiscount: true },
                { id: 'u5', name: "Cutamycon Clotrimazol 1% Crema X 20 Gr", price: 15507.28, category: "Dermatológico", hasDiscount: true },
                { id: 'u6', name: "Cutamycon Clotrimazol 500 Mg Vaginal X 1 Ovulo", price: 39961.07, category: "Ginecológico", hasDiscount: true },
                { id: 'u7', name: "Descongel Gripa Jarabe X 60 Ml", price: 15459.56, category: "Respiratorio", hasDiscount: true },
                { id: 'u8', name: "Descongel Gripa Jarabe X 60 Ml (2) Ahorre 20%", price: 30537.42, category: "Respiratorio", hasDiscount: true },
                { id: 'u9', name: "Descongel Gripa X 10 Cap", price: 14783.21, category: "Respiratorio", hasDiscount: true },
                { id: 'u10', name: "Descongel Gripa X 100 Cap", price: 117009.60, category: "Respiratorio", hasDiscount: true },
                { id: 'u11', name: "Descongelito F Gripa Gotas X 15 Ml", price: 15136.84, category: "Infantil", hasDiscount: true },
                { id: 'u12', name: "Desloran Desloratadina 2.5 Mg Jarabe X 60 Ml", price: 79683.57, category: "Antihistamínico", hasDiscount: true },
                { id: 'u13', name: "Duopas Ibuprofeno/hioscina 400/20 Mg X 10 Cap", price: 39436.21, category: "Dolor", hasDiscount: true },
                { id: 'u14', name: "Estermax Estrogenos Conjugados 0.625 Mg X 28 Tabl", price: 28132.60, category: "Hormonal", hasDiscount: false },
                { id: 'u15', name: "Estermax Estrogenos Conjugados Crema Vaginal X 40 Gr", price: 30546.96, category: "Hormonal", hasDiscount: false },
                { id: 'u16', name: "Femtriol Estriol 0.1 Gr Crema Vaginal X 20 Gr + 5 Aplicadores", price: 25498.00, category: "Hormonal", hasDiscount: false },
                { id: 'u17', name: "Fluturan Ibuprofeno/desloratadiona X 10 Cap", price: 35070.31, category: "Dolor", hasDiscount: true },
                { id: 'u18', name: "Fluzetrin F Jarabe X 60 Ml", price: 34831.74, category: "Respiratorio", hasDiscount: true },
                { id: 'u19', name: "Fluzetrin F X 10 Tabl", price: 31968.86, category: "Respiratorio", hasDiscount: true },
                { id: 'u20', name: "Friotan Hedera Helix 65 Mg X 10 Cap", price: 34473.88, category: "Natural", hasDiscount: true },
                { id: 'u21', name: "Friotan Hereda Helix + Propoleo Jarabe X 120 Ml", price: 24348.81, category: "Natural", hasDiscount: true },
                { id: 'u22', name: "Inflabon Budesonida 200 Mcg Inhalador X 200 Dosis", price: 146007.03, category: "Respiratorio", hasDiscount: true },
                { id: 'u23', name: "Inflabon Budesonida 50 Mcg Inhalador X 200 Dosis", price: 124058.26, category: "Respiratorio", hasDiscount: true },
                { id: 'u24', name: "Inflacor Betametasona 8 Mg/2 Ml X 1 Amp + Jer", price: 37098.19, category: "Corticoide", hasDiscount: true },
                { id: 'u25', name: "Inflacor Retard Betametasona 3+3/ml X 1 Amp + Jer", price: 42585.38, category: "Corticoide", hasDiscount: true },
                { id: 'u26', name: "Inflacor Retard Betametasona 6+6/2 Ml X 1 Amp + Jer", price: 63937.71, category: "Corticoide", hasDiscount: true },
                { id: 'u27', name: "Lactulax Lactulosa 10 Gr X 12 Sobres", price: 102228.78, category: "Gastrointestinal", hasDiscount: true },
                { id: 'u28', name: "Lactulax Lactulosa 66.7/100 G/ml Susp X 240 Ml", price: 104733.80, category: "Gastrointestinal", hasDiscount: true },
                { id: 'u29', name: "Multidol Ibuprofeno 400 Mg X 48 Cap", price: 63102.71, category: "Dolor", hasDiscount: true },
                { id: 'u30', name: "Multidol Ibuprofeno 800 Mg X 30 Cap", price: 81711.45, category: "Dolor", hasDiscount: true },
                { id: 'u31', name: "Neuropron Jeringa Prellenada X 3 Und", price: 109385.98, category: "Dolor", hasDiscount: true },
                { id: 'u32', name: "Simpause Isoflabona Soya 100 Mg X 30 Cap", price: 103540.93, category: "Hormonal", hasDiscount: true },
                { id: 'u33', name: "Terex-3 Terconazol/dexametasona Crema X 20 Gr", price: 75747.00, category: "Ginecológico", hasDiscount: true },
                { id: 'u34', name: "Tibonella Tibolona 2.5 Mg X 28 Tabl", price: 32646.41, category: "Hormonal", hasDiscount: false },
                { id: 'u35', name: "Trigentax Crema X 20 Gr", price: 28539.36, category: "Dermatológico", hasDiscount: true },
                { id: 'u36', name: "Trigentax Crema X 40 Gr", price: 44106.29, category: "Dermatológico", hasDiscount: true },
                { id: 'u37', name: "Trigentax Crema X 20 Gr (3) + Gratis (1) Dental", price: 85624.61, category: "Oferta", hasDiscount: true },
                { id: 'u38', name: "Trigentax Crema X 40 Gr (4) + Gratis (1) Electrolit", price: 176431.69, category: "Oferta", hasDiscount: true },
                { id: 'u39', name: "Vaginsol F Crema Vaginal X 20 Gr", price: 95429.43, category: "Ginecológico", hasDiscount: true },
                { id: 'u40', name: "Zakor Mebendazol 20mg/ml Suspension X 30 Ml", price: 10616.52, category: "Antiparasitario", hasDiscount: true },
            ];

            // --- DATOS DROSAN ---
            const productsDrosan = [
                { id: 'd1', name: "AIRMAX AEROSOL HFC X 200DOSIS (1+1)", price: 27609, finalPrice: 27609, category: "Respiratorio" },
                { id: 'd2', name: "AIRMAX AEROSOL HFC X 200DOSIS", price: 27608, finalPrice: 27608, category: "Respiratorio" },
                { id: 'd3', name: "ASPROMIO AEROSOL X 200 DOSIS", price: 21983, finalPrice: 21983, category: "Respiratorio" },
                { id: 'd4', name: "BIFIDOLAC 170MG X 6SOB", price: 65948, finalPrice: 65948, category: "Gastrointestinal" },
                { id: 'd5', name: "BUSTEROL AEROSOL HFC X 200 DOSIS", price: 173688, finalPrice: 173688, category: "Respiratorio" },
                { id: 'd6', name: "CLOBEZAN CR X 25GR", price: 43483, finalPrice: 43483, category: "Dermatológico" },
                { id: 'd7', name: "CLOBEZAN UNG X 25GR", price: 55803, finalPrice: 55803, category: "Dermatológico" },
                { id: 'd8', name: "CUTAMYCON 500 X 1CBG", price: 40463, finalPrice: 40463, category: "Ginecológico" },
                { id: 'd9', name: "CUTAMYCON CR TOPICA X 20GR", price: 15702, finalPrice: 13504, category: "Dermatológico" },
                { id: 'd10', name: "DESCONGEL F JBE X 60ML", price: 17393, finalPrice: 13914, category: "Respiratorio" },
                { id: 'd11', name: "DESCONGEL GRIPA X 10CBG", price: 16632, finalPrice: 14304, category: "Respiratorio" },
                { id: 'd12', name: "DESCONGEL LS X 100CAP", price: 131643, finalPrice: 105314, category: "Respiratorio" },
                { id: 'd13', name: "DESCONGELITO F GOTAS X 15ML", price: 17030, finalPrice: 13624, category: "Infantil" },
                { id: 'd14', name: "DESLORAN 5 MG X 10TBS", price: 79355, finalPrice: 79355, category: "Antihistamínico" },
                { id: 'd15', name: "DESLORAN JBE 0.05% X 60ML", price: 80684, finalPrice: 80684, category: "Antihistamínico" },
                { id: 'd16', name: "DOLFENAX 200MG X 10CAPS", price: 46985, finalPrice: 46985, category: "Dolor" },
                { id: 'd17', name: "DUOPAS 400/200MG X 10TBS GTS USA TEST", price: 45906, finalPrice: 39479, category: "Dolor" },
                { id: 'd18', name: "DUOPAS 400/20MG X 10TBS", price: 45898, finalPrice: 39472, category: "Dolor" },
                { id: 'd19', name: "ESTERMAX 0.625MG CR VAG X40GR", price: 35148, finalPrice: 35148, category: "Hormonal" },
                { id: 'd20', name: "ESTERMAX 0.625MG X28TBS", price: 32370, finalPrice: 32370, category: "Hormonal" },
                { id: 'd21', name: "FEMTRIOL CR VAG X 20GR", price: 29955, finalPrice: 29955, category: "Hormonal" },
                { id: 'd22', name: "FLUTURAN X 10CBG", price: 35511, finalPrice: 35511, category: "Dolor" },
                { id: 'd23', name: "FLUZETRIN F GOTAS PED X 15ML", price: 24241, finalPrice: 24241, category: "Infantil" },
                { id: 'd24', name: "FLUZETRIN F JBE X 60ML", price: 31742, finalPrice: 31742, category: "Respiratorio" },
                { id: 'd25', name: "FLUZETRIN F X 10CAP", price: 29133, finalPrice: 29133, category: "Respiratorio" },
                { id: 'd26', name: "FRIOTAN 65MG X 10CAPS", price: 34906, finalPrice: 34906, category: "Natural" },
                { id: 'd27', name: "FRIOTAN JBE X 120ML", price: 28988, finalPrice: 28988, category: "Natural" },
                { id: 'd28', name: "INFLABON 200MCG HFC AEROSOL", price: 147840, finalPrice: 147840, category: "Respiratorio" },
                { id: 'd29', name: "INFLABON 50MCG HFC AEROSOL", price: 125615, finalPrice: 125615, category: "Respiratorio" },
                { id: 'd30', name: "INFLACOR 4 MG AMP X 1ML", price: 20292, finalPrice: 20292, category: "Corticoide" },
                { id: 'd31', name: "INFLACOR 8 MG AMP X 2ML", price: 37564, finalPrice: 32305, category: "Corticoide" },
                { id: 'd32', name: "INFLACOR RET 6/6MG AMP X 2ML", price: 58804, finalPrice: 58804, category: "Corticoide" },
                { id: 'd33', name: "LACTULAX JBE X240ML", price: 103005, finalPrice: 103005, category: "Gastrointestinal" },
                { id: 'd34', name: "LACTULAX X 12S/S", price: 103512, finalPrice: 103512, category: "Gastrointestinal" },
                { id: 'd35', name: "MULTIDOL 800MG X 30CBG", price: 82737, finalPrice: 82737, category: "Dolor" },
                { id: 'd36', name: "MULTIDOL EXPRESS 400MG X 48CBG", price: 63895, finalPrice: 63895, category: "Dolor" },
                { id: 'd37', name: "MULTIDOL EXPRESS 400MG X 48CBG GTS", price: 63902, finalPrice: 63902, category: "Dolor" },
                { id: 'd38', name: "NEUROPRON INY 2ML X 3AMP", price: 99683, finalPrice: 79747, category: "Dolor" },
                { id: 'd39', name: "SIMPAUSE 100MG X 30CBG", price: 98923, finalPrice: 98923, category: "Hormonal" },
                { id: 'd40', name: "TEREX CR VAG X 20GR", price: 76698, finalPrice: 76698, category: "Ginecológico" },
                { id: 'd41', name: "TIBONELLA 2.5MG X 28TBS", price: 37564, finalPrice: 37564, category: "Hormonal" },
                { id: 'd42', name: "TRIGENTAX CR X 20GR", price: 29894, finalPrice: 23915, category: "Dermatológico" },
                { id: 'd43', name: "TRIGENTAX CR X 40GR", price: 46200, finalPrice: 36960, category: "Dermatológico" },
                { id: 'd44', name: "TRIGENTAX LOC TOP. X 50ML", price: 54788, finalPrice: 47118, category: "Dermatológico" },
                { id: 'd45', name: "VAGINSOL F 100+200MG X 3 OVULOS", price: 97835, finalPrice: 97835, category: "Ginecológico" },
                { id: 'd46', name: "VAGINSOL F CR VAG X 20GR", price: 96627, finalPrice: 96627, category: "Ginecológico" },
                { id: 'd47', name: "ZAKOR 100MG X 6 TBS", price: 7368, finalPrice: 7368, category: "Antiparasitario" },
            ];

            // --- DATOS COPIDROGAS ---
            const productsCopidrogas = [
                { id: 'c1', name: "ZAKOR 100 MG 6 TABLETAS", price: 7094, finalPrice: 7094, stock: 0, category: "Antiparasitario" },
                { id: 'c2', name: "VAGINSOL F CREMA VAG.20 GR 3 APL.(3%+)", price: 93103, finalPrice: 90310, stock: 0, category: "Ginecológico" },
                { id: 'c3', name: "VAGINSOL F 200100 MG OVULOS 3 UNDS(3%+)", price: 94322, finalPrice: 91492, stock: 0, category: "Ginecológico" },
                { id: 'c4', name: "TRIGENTAX LOCION 50 ML", price: 51777, finalPrice: 51777, stock: 0, category: "Dermatológico" },
                { id: 'c5', name: "TRIGENTAX CREMA 40 GR", price: 42371, finalPrice: 36863, stock: 35, category: "Dermatológico" },
                { id: 'c6', name: "TRIGENTAX CREMA 20 GR", price: 27456, finalPrice: 23887, stock: 292, category: "Dermatológico" },
                { id: 'c7', name: "TIBONELLA 2.5 MG 28 TBS (P)33116(SC)", price: 29545, finalPrice: 29545, stock: 0, category: "Hormonal" },
                { id: 'c8', name: "TEREX-3 CREMA VAGINAL 20 GR", price: 70381, finalPrice: 70381, stock: 33, category: "Ginecológico" },
                { id: 'c9', name: "SIMPAUSE 100 MG 30 CAPSULA BLANDA(3%+)", price: 100972, finalPrice: 97943, stock: 0, category: "Hormonal" },
                { id: 'c10', name: "PARAXIN SUSPENSION 30 ML", price: 56416, finalPrice: 56416, stock: 0, category: "Antiparasitario" },
                { id: 'c11', name: "PARAXIN 500 MG 6 TABLETAS", price: 82130, finalPrice: 82130, stock: 0, category: "Antiparasitario" },
                { id: 'c12', name: "NEUROPRON 10.000 SOL.INY.2 ML 3 UND(3%+)", price: 106736, finalPrice: 103534, stock: 0, category: "Dolor" },
                { id: 'c13', name: "NEUROPRON 10.000 JERINGA PRELLENADA", price: 22611, finalPrice: 22611, stock: 0, category: "Dolor" },
                { id: 'c14', name: "MULTIDOL 800 MG 30 CAP.BLANDA GELATINOSA", price: 79691, finalPrice: 79691, stock: 0, category: "Dolor" },
                { id: 'c15', name: "MULTIDOL EXPRESS 400 MG 48 CBG", price: 61514, finalPrice: 61514, stock: 17, category: "Dolor" },
                { id: 'c16', name: "LACTULAX JARABE 240 ML (3%+)", price: 102191, finalPrice: 99125, stock: 32, category: "Gastrointestinal" },
                { id: 'c17', name: "LACTULAX 12 SBS JARABE 15 ML (3%+)", price: 99753, finalPrice: 96760, stock: 137, category: "Gastrointestinal" },
                { id: 'c18', name: "INFLACOR RETARD 6+6 MG 2 ML AMPOLLA", price: 62401, finalPrice: 62401, stock: 0, category: "Corticoide" },
                { id: 'c19', name: "INFLACOR RETARD 3+3 MG 1 ML AMPOLLA", price: 41564, finalPrice: 41564, stock: 0, category: "Corticoide" },
                { id: 'c20', name: "INFLACOR 8 MG 2 ML AMPOLLA", price: 36244, finalPrice: 36244, stock: 0, category: "Corticoide" },
                { id: 'c21', name: "INFLACOR 4 MG 1 ML AMPOLLA", price: 19507, finalPrice: 19507, stock: 0, category: "Corticoide" },
                { id: 'c22', name: "INFLABON INHALADOR 50 MCG 200 DOSIS(3%+)", price: 121034, finalPrice: 117403, stock: 101, category: "Respiratorio" },
                { id: 'c23', name: "INFLABON INHALADOR 200 MCG 200 DOSIS", price: 142425, finalPrice: 142425, stock: 14, category: "Respiratorio" },
                { id: 'c24', name: "FYNEXIN GEL 5% TUBO 20 GR", price: 25049, finalPrice: 25049, stock: 0, category: "Dermatológico" },
                { id: 'c25', name: "FRIOTAN HEDERA HELIX JARABE 120 ML", price: 29372, finalPrice: 23497, stock: 24, category: "Natural" },
                { id: 'c26', name: "FRIOTAN HEDERA HELIX 65MG 10 CAPSULAS", price: 33584, finalPrice: 26867, stock: 2, category: "Natural" },
            ];

            const formatCOP = (amount) => {
                return new Intl.NumberFormat('es-CO', {
                    style: 'currency',
                    currency: 'COP',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0,
                }).format(amount);
            };

            const currentProducts = useMemo(() => {
                if (supplier === 'Unidrogas') return productsUnidrogas;
                if (supplier === 'Drosan') return productsDrosan;
                return productsCopidrogas;
            }, [supplier]);

            const filteredProducts = useMemo(() => {
                let result = currentProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.category.toLowerCase().includes(searchTerm.toLowerCase())
                );

                result.sort((a, b) => {
                    return sortOrder === 'asc' 
                        ? a.name.localeCompare(b.name) 
                        : b.name.localeCompare(a.name);
                });

                return result;
            }, [searchTerm, sortOrder, currentProducts, supplier]);

            const addToCart = (id) => {
                setCart(prev => ({ ...prev, [id]: (prev[id] || 0) + 1 }));
            };

            const removeFromCart = (id) => {
                setCart(prev => {
                    const newCart = { ...prev };
                    if (newCart[id] > 1) {
                        newCart[id] -= 1;
                    } else {
                        delete newCart[id];
                    }
                    return newCart;
                });
            };

            const clearCurrentViewCart = () => {
                if (window.confirm(`¿Limpiar solo el pedido actual de ${supplier}? Los pedidos de otros depósitos no se borrarán.`)) {
                    setCart(prev => {
                        const newCart = { ...prev };
                        currentProducts.forEach(p => {
                            if (newCart[p.id]) {
                                delete newCart[p.id];
                            }
                        });
                        return newCart;
                    });
                }
            };

            const clearAllCache = () => {
                if(window.confirm("¿ATENCIÓN: Estás seguro de eliminar TODOS los pedidos almacenados en memoria? Se borrarán los carritos de Unidrogas, Drosan y Copidrogas.")) {
                    setCart({});
                    localStorage.removeItem('pharmaCart_v1');
                }
            };

            const nextSupplier = () => {
                let next;
                if (supplier === 'Unidrogas') next = 'Drosan';
                else if (supplier === 'Drosan') next = 'Copidrogas';
                else next = 'Unidrogas';
                setSupplier(next);
            };

            const calculateTotals = () => {
                let subtotalList = 0;
                let totalFinal = 0;
                let totalItems = 0;

                Object.entries(cart).forEach(([id, qty]) => {
                    const product = currentProducts.find(p => p.id === id);
                    if (product) {
                        const itemListPrice = product.price * qty;
                        let itemFinalPrice = 0;

                        if (supplier === 'Unidrogas') {
                            const unitFinal = product.hasDiscount ? product.price * (1 - UNIDROGAS_DISCOUNT_RATE) : product.price;
                            itemFinalPrice = unitFinal * qty;
                        } else {
                            itemFinalPrice = product.finalPrice * qty;
                        }
                        
                        subtotalList += itemListPrice;
                        totalFinal += itemFinalPrice;
                        totalItems += qty;
                    }
                });

                return { 
                    subtotalList, 
                    savings: subtotalList - totalFinal, 
                    totalFinal, 
                    totalItems 
                };
            };

            const { subtotalList, savings, totalFinal, totalItems } = calculateTotals();

            const getTheme = () => {
                switch(supplier) {
                    case 'Unidrogas': 
                        return { color: 'blue', bg: 'bg-blue-600', lightBg: 'bg-blue-50', text: 'text-blue-700', hover: 'hover:bg-blue-700', border: 'border-blue-100' };
                    case 'Drosan': 
                        return { color: 'emerald', bg: 'bg-emerald-600', lightBg: 'bg-emerald-50', text: 'text-emerald-700', hover: 'hover:bg-emerald-700', border: 'border-emerald-100' };
                    case 'Copidrogas': 
                        return { color: 'indigo', bg: 'bg-indigo-600', lightBg: 'bg-indigo-50', text: 'text-indigo-700', hover: 'hover:bg-indigo-700', border: 'border-indigo-100' };
                    default: return {};
                }
            }
            
            const theme = getTheme();

            return (
                <div className="flex flex-col h-full bg-gray-50 text-gray-800 font-sans">
                    <header className="bg-white shadow-sm border-b border-gray-200 p-4 sticky top-0 z-10">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-2">
                                <div className={`p-2 rounded-lg transition-colors duration-300 ${theme.bg}`}>
                                    <Store className="text-white w-6 h-6" />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-gray-900 flex items-center gap-2">
                                        Catálogo {supplier}
                                    </h1>
                                    <p className="text-xs text-gray-500 font-medium">
                                        {supplier === 'Unidrogas' && 'Condición: 12% Dscto a 60 días'}
                                        {supplier === 'Drosan' && 'Condición: Precios Teleferia / Subtotal'}
                                        {supplier === 'Copidrogas' && 'Condición: Precio Real vs Corriente + Stock'}
                                    </p>
                                </div>
                            </div>

                            <div className="flex flex-wrap items-center gap-2 w-full md:w-auto">
                                <button 
                                    onClick={clearAllCache}
                                    className="flex items-center gap-2 px-3 py-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg text-xs font-bold transition-colors border border-red-200 shadow-sm mr-2"
                                    title="Borrar memoria de todos los pedidos"
                                >
                                    <Trash2 className="w-3 h-3" />
                                    <span className="hidden lg:inline">ELIMINAR CACHE TODOS PEDIDOS</span>
                                    <span className="lg:hidden">BORRAR TODO</span>
                                </button>

                                <button 
                                    onClick={nextSupplier}
                                    className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors border border-gray-300 shadow-sm"
                                    title="Cambiar al siguiente proveedor"
                                >
                                    <RefreshCw className="w-4 h-4" />
                                    <span className="hidden md:inline">Cambiar Proveedor</span>
                                    <span className="md:hidden">Cambiar</span>
                                </button>

                                <div className="relative flex-grow md:w-64">
                                    <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <Search className="w-4 h-4" />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Buscar referencia..."
                                        className={`w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 outline-none transition-all text-sm focus:ring-${theme.color}-500 focus:border-${theme.color}-500`}
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                                <button 
                                    onClick={() => setSortOrder(prev => prev === 'asc' ? 'desc' : 'asc')}
                                    className="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors"
                                    title="Ordenar alfabéticamente"
                                >
                                    <ArrowUpDown className="w-5 h-5 text-gray-600" />
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-grow overflow-hidden flex flex-col md:flex-row max-w-7xl mx-auto w-full">
                        
                        <div className="flex-grow overflow-y-auto p-4 md:p-6">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {filteredProducts.map(product => {
                                    let finalPrice = 0;
                                    let hasDiscount = false;
                                    let stockAvailable = true;

                                    if (supplier === 'Unidrogas') {
                                        hasDiscount = product.hasDiscount;
                                        finalPrice = hasDiscount ? product.price * (1 - UNIDROGAS_DISCOUNT_RATE) : product.price;
                                    } else {
                                        hasDiscount = product.finalPrice < product.price;
                                        finalPrice = product.finalPrice;
                                    }

                                    if (supplier === 'Copidrogas') {
                                        stockAvailable = product.stock > 0;
                                    }

                                    const qty = cart[product.id] || 0;

                                    return (
                                        <div key={product.id} className={`bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow flex flex-col overflow-hidden relative ${!stockAvailable ? 'opacity-70' : ''}`}>
                                            <div className={`absolute top-0 right-0 px-2 py-1 rounded-bl-lg text-[10px] font-bold tracking-wide uppercase ${hasDiscount ? `${theme.lightBg} ${theme.text}` : 'bg-gray-100 text-gray-500'}`}>
                                                {hasDiscount 
                                                ? (supplier === 'Unidrogas' ? '12% OFF' : 'OFERTA') 
                                                : 'NETO'}
                                            </div>

                                            {supplier === 'Copidrogas' && (
                                                <div className={`absolute top-0 left-0 px-2 py-1 rounded-br-lg text-[10px] font-bold tracking-wide uppercase text-white ${product.stock > 0 ? 'bg-green-500' : 'bg-red-500'}`}>
                                                    {product.stock > 0 ? `Stock: ${product.stock}` : 'AGOTADO'}
                                                </div>
                                            )}

                                            <div className="p-4 flex-grow">
                                                <div className="flex justify-between items-start mb-2 mt-4">
                                                    <span className="text-[10px] font-bold tracking-wider text-gray-500 uppercase bg-gray-100 px-2 py-1 rounded">
                                                        {product.category}
                                                    </span>
                                                    {qty > 0 && (
                                                        <span className={`${theme.bg} text-white text-xs font-bold px-2 py-1 rounded-full`}>
                                                            x{qty}
                                                        </span>
                                                    )}
                                                </div>
                                                <h3 className="font-semibold text-gray-800 text-sm leading-tight mb-3 min-h-[40px]">
                                                    {product.name}
                                                </h3>
                                                
                                                <div className="space-y-1">
                                                    {hasDiscount ? (
                                                        <>
                                                            <div className="flex justify-between items-center text-xs text-gray-400 line-through">
                                                                <span>{supplier === 'Copidrogas' ? '$ Corriente' : 'Precio Lista'}:</span>
                                                                <span>{formatCOP(product.price)}</span>
                                                            </div>
                                                            <div className={`flex justify-between items-center text-lg font-bold ${theme.text}`}>
                                                                <span className={`text-sm font-normal`}>{supplier === 'Copidrogas' ? '$ Real' : 'Final'}:</span>
                                                                <span>{formatCOP(finalPrice)}</span>
                                                            </div>
                                                        </>
                                                    ) : (
                                                        <div className="flex justify-between items-center text-lg font-bold text-gray-700 mt-4">
                                                            <span className="text-sm font-normal text-gray-500">Precio:</span>
                                                            <span>{formatCOP(product.price)}</span>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            <div className={`p-3 border-t flex items-center justify-between ${hasDiscount ? `${theme.lightBg} ${theme.border}` : 'bg-gray-50 border-gray-100'}`}>
                                                {hasDiscount ? (
                                                    <div className="text-xs text-green-600 font-medium flex items-center gap-1">
                                                        <TrendingDown className="w-3 h-3" />
                                                        Ahorras {formatCOP(product.price - finalPrice)}
                                                    </div>
                                                ) : (
                                                    <div className="text-xs text-gray-400 flex items-center gap-1">
                                                        <AlertCircle className="w-3 h-3" />
                                                        Precio Neto
                                                    </div>
                                                )}
                                                
                                                <div className="flex items-center gap-2">
                                                    {qty > 0 && (
                                                        <button 
                                                            onClick={() => removeFromCart(product.id)}
                                                            className="w-8 h-8 flex items-center justify-center rounded-full border border-gray-300 hover:bg-white text-gray-600 hover:text-red-600 transition-colors"
                                                        >
                                                            -
                                                        </button>
                                                    )}
                                                    <button 
                                                        onClick={() => addToCart(product.id)}
                                                        disabled={!stockAvailable}
                                                        className={`text-white text-xs font-bold py-2 px-4 rounded-lg transition-colors shadow-sm active:transform active:scale-95 ${!stockAvailable ? 'bg-gray-400 cursor-not-allowed' : `${theme.bg} ${theme.hover}`}`}
                                                    >
                                                        {!stockAvailable ? 'SIN STOCK' : (qty === 0 ? 'AGREGAR' : '+')}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {filteredProducts.length === 0 && (
                                <div className="text-center py-20 text-gray-400">
                                    <div className="w-16 h-16 mx-auto mb-4 opacity-20 flex justify-center items-center">
                                        <Package className="w-full h-full" />
                                    </div>
                                    <p>No se encontraron productos en el catálogo de {supplier}.</p>
                                </div>
                            )}
                        </div>

                        <aside className="w-full md:w-80 bg-white border-l border-gray-200 shadow-xl z-20 flex flex-col">
                            <div className="p-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
                                <h2 className="font-bold text-gray-700 flex items-center gap-2">
                                    <ShoppingCart className="w-5 h-5" />
                                    Pedido {supplier}
                                </h2>
                                {totalItems > 0 && (
                                    <button 
                                        onClick={clearCurrentViewCart}
                                        className="text-xs text-gray-400 hover:text-red-600 flex items-center gap-1 transition-colors"
                                        title={`Solo borra items de ${supplier}`}
                                    >
                                        <Trash2 className="w-3 h-3" /> Limpiar {supplier}
                                    </button>
                                )}
                            </div>

                            <div className="flex-grow overflow-y-auto p-4">
                                {totalItems === 0 ? (
                                    <div className="h-full flex flex-col items-center justify-center text-center text-gray-400 space-y-3">
                                        <div className="bg-gray-100 p-4 rounded-full">
                                            <DollarSign className="w-8 h-8 text-gray-300" />
                                        </div>
                                        <p className="text-sm px-6">Agrega referencias de {supplier} para calcular el total.</p>
                                        <p className="text-xs px-6 text-gray-300">Tus pedidos de otros depósitos están guardados.</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {Object.entries(cart).map(([id, qty]) => {
                                            const product = currentProducts.find(p => p.id === id);
                                            if(!product) return null;
                                            
                                            let finalPrice = 0;
                                            let hasDiscount = false;
                                            
                                            if (supplier === 'Unidrogas') {
                                                hasDiscount = product.hasDiscount;
                                                finalPrice = hasDiscount ? product.price * (1 - UNIDROGAS_DISCOUNT_RATE) : product.price;
                                            } else {
                                                hasDiscount = product.finalPrice < product.price;
                                                finalPrice = product.finalPrice;
                                            }

                                            return (
                                                <div key={id} className="text-sm border-b border-gray-100 pb-2">
                                                    <div className="flex justify-between font-medium text-gray-700">
                                                        <span className="truncate w-40">{product.name}</span>
                                                        <span>x{qty}</span>
                                                    </div>
                                                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                                                        <div className="flex flex-col">
                                                            <span>Base: {formatCOP(product.price * qty)}</span>
                                                            {!hasDiscount && <span className="text-[10px] text-orange-500">Sin Dscto</span>}
                                                        </div>
                                                        <span className={`font-bold ${theme.text}`}>
                                                            {formatCOP(finalPrice * qty)}
                                                        </span>
                                                    </div>
                                                </div>
                                            )
                                        })}
                                    </div>
                                )}
                            </div>

                            <div className="p-6 bg-gray-50 border-t border-gray-200 space-y-3">
                                <div className="flex justify-between text-sm text-gray-500">
                                    <span>Subtotal (Precio Lista):</span>
                                    <span>{formatCOP(subtotalList)}</span>
                                </div>
                                {savings > 0 && (
                                    <div className="flex justify-between text-sm text-green-600 font-bold bg-green-50 p-2 rounded border border-green-100">
                                        <span className="flex items-center gap-1"><TrendingDown className="w-3 h-3" /> Ahorro Total:</span>
                                        <span>- {formatCOP(savings)}</span>
                                    </div>
                                )}
                                <div className="pt-3 border-t border-gray-200">
                                    <div className="flex justify-between items-end">
                                        <span className="text-gray-900 font-bold">Total a Pagar:</span>
                                        <span className={`text-2xl font-bold ${theme.text}`}>{formatCOP(totalFinal)}</span>
                                    </div>
                                    <p className="text-[10px] text-gray-400 text-right mt-1">
                                        *IVA 0%
                                    </p>
                                </div>
                                
                                <button className={`w-full text-white font-bold py-3 rounded-lg shadow-lg hover:shadow-xl transition-all active:scale-[0.98] ${theme.bg} ${theme.hover}`}>
                                    Finalizar Pedido {supplier}
                                </button>
                            </div>
                        </aside>

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProductCatalog />);
    </script>
</body>
</html>
